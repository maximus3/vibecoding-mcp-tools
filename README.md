### Запуск через uv
Требуется установленный `uv`. Проверить путь:

```
uv --version
```

Синхронизировать зависимости (установит `mcp`, `fastapi`, `uvicorn[standard]`):

```
uv sync
```

Запустить MCP-сервер (stdio) в окружении проекта:

```
uv run --directory . mcp_server.py
```

### Тула `ask_user`

Пример вызова (со стороны клиента MCP/LLM):

```
tool: "ask_user"
params: {
  "question": "Какой у вас email для связи?",
  "placeholder": "Введите email",
  "quick_answers": ["name@example.com"],
  "hints": ["Можно указать рабочий или личный email"],
  "timeout_seconds": 180
}
```

Возвращаемое значение:

```
{
  "answer": "name@example.com",
  "source": "text", // или "voice"
  "duration_ms": 53210
}
```

Поведение:
- Локально поднимается временный HTTP-сервер на `127.0.0.1:<random_port>` (FastAPI + Uvicorn).
- Сформируется одноразовый `session_token` (UUIDv4) и будет добавлен в URL (`/?t=<token>`).
- Откроется системный браузер с локальной страницей.
- На странице доступен текстовый ввод и голосовой (через Web Speech API при наличии; иначе отображается понятное уведомление и доступен только текстовый ввод).
- После отправки ответ уходит на `POST /submit` и окно сообщает, что его можно закрыть.
- Сервер валидирует токен, завершает сессию и возвращает ответ в MCP-тулу.
- По таймауту сервер корректно завершится, тулы вернёт исключение `TimeoutError`.

Безопасность:
- Слушает только `127.0.0.1`.
- Одноразовый `session_token` обязателен в `GET`/`POST`.
- CORS разрешён только для текущего локального origin.

Ограничения:
- Всплывающее окно реализовано через локальную веб‑страницу в системном браузере. Это обеспечивает совместимость с MCP и простое управление жизненным циклом.

### Интеграция с Cursor MCP

В `~/.cursor/mcp.json` уже настроено на `uv run`:

```
{
  "mcpServers": {
    "ask-user-mcp": {
      "command": "uv",
      "args": [
        "run",
        "--directory",
        "/absolute/path/to/mcp_server", // замените на ваш абсолютный путь
        "mcp_server.py"
      ]
    }
  }
}
```

### Зависимости

Проект использует `pyproject.toml` и `uv.lock`. При первом запуске `uv run` автоматически создаст/синхронизирует `.venv` рядом с проектом. Для добавления пакета:

```
uv add <package>
```
